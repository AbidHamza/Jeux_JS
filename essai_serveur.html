<html>
  <head>
     <meta charset="UTF8" />
     <meta content="utf-8" http-equiv="encoding">
     <script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js'></script>
     <script src="https://d3js.org/d3.v5.min.js"></script>
     <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
     <script>
       window.addEventListener("DOMContentLoaded", (event) => {
        var choix = document.getElementById("lvl-select");
        choix.addEventListener("change", function(){
          // Appel du serveur pour qu'il nous envoie le modèle enrgistré dans niveau1.json
         $.getJSON("http://localhost:8888/niveau/"+choix.value, function(data) {
             // Ouvrir la console du navigateur pour vérifier que cela fonctionne
            d3.selectAll("circle").remove();
            var start = genereModele(data,72, 12, 13);
            console.log(start)
            var svg = d3.select("#damier").select("svg")
            var circle = svg.append("svg:circle")
              .attr("cy", start[1]+pas/2)
              .attr("cx", start[0]+pas/2)
              .attr("r",10)
              .attr("id","avatar")
              .attr("fill","yellow");
            d3.select("body").on("keydown",function(){
              var avatar_x = parseInt(d3.select("#avatar").attr("cx")/pas);
              var avatar_y = parseInt(d3.select("#avatar").attr("cy")/pas);
              var up = data[avatar_y-1][avatar_x];
              var down = data[avatar_y+1][avatar_x];
              var right = data[avatar_y][avatar_x+1];
              var left = data[avatar_y][avatar_x-1];

              let imd =""+(avatar_y+1)+""+avatar_x
              let imu =""+(avatar_y-1)+avatar_x
              let imr =""+avatar_y+(avatar_x+1)
              let iml =""+avatar_y+(avatar_x-1)
              console.log(""+avatar_y+avatar_x)
                
                switch(d3.event.keyCode){
                  case 68 :
                    if (right.type!=1 && right.type!=5){
                      droit()
                      clearLoot()
                    }
                    interaction(right,imr)
                  break;//d
                  case 83 :
                    if (down.type!=1 && down.type!=5){
                      im = ""+avatar_y+1+avatar_x
                      bas()
                      clearLoot()

                      
                    }
                    interaction(down,imd)
                  break;//s
                  case 81 :
                    if (left.type!=1 && left.type!=5){
                      gauche()
                      clearLoot()
                    }
                    interaction(left,iml)

                  break;//q
                  case 90 :
                    if (up.type!=1 && up.type!=5){
                      haut()
                      clearLoot()
                      }
                    interaction(up,imu)
                  break;//z
                  
                }
                
              
            });
            
             
        })
      });



        

       $().ready(function() {
       //var modele = [[2, 1, 1, 1, 1, 1, 1, 4, 1, 1, 1, 1, 1],[2, 1, 0, 3, 0, 1, 1, 5, 1, 0, 0, 3, 1],[2, 1, 0, 7, 0, 1, 0, 0, 1, 0, 7, 0, 1],[2, 1, 0, 0, 0, 1, 0, 3, 1, 0, 0, 0, 1],[1, 1, 5, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1],[1, 0, 0, 7, 0, 1, 0, 0, 6, 0, 0, 0, 1],[1, 0, 7, 7, 0, 6, 0, 0, 1, 0, 0, 3, 1],[1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1],[1, 1, 1, 6, 1, 1, 0, 0, 1, 0, 3, 0, 1],[2, 2, 1, 0, 7, 1, 0, 0, 6, 0, 0, 0, 1],[2, 2, 1, 7, 3, 1, 0, 0, 1, 0, 0, 8, 1],[2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]]
        
         // Appel du serveur pour qu'il enregistre le modèle dans un fichier
         //$.ajax({url:"http://localhost:8881/niveau/1", type:"POST", data:{data: modele}, dataType:"json"});

         
         });
  });
      </script>
      <script src="ressources.js"></script>
      <script src="damier.js"></script>
      <script src = "barre_de_vie.js"></script>
      <script src = "gameplay.js"></script>
      <style type="text/css">

        </style>
  </head>
  <body onLoad="genereDamier(72,12,13), genereInventaire(100,2,5), genereInventaireCase(100,2,5),healthBarr()">
    
    <div id="choixlvl">
      <label for="select">Choose a level:</label>
      <select name="level" id="lvl-select">
          <option value="" selected>--Please choose a level--</option>
          <option value="1">Level 1</option>
          <option value="2">Level 2</option>
      </select>
    </div>
    <br>
    <div id="barreVie" style="margin-left: 1100px; position : absolute; top : 100px">Point de vie :<br> </div>
    <div id="inventaire_case" style="margin-left: 1100px; position : absolute; top : 200px"> Loot <br></div>
    <div id="damier"></div>
    <div id="inventaire" style="margin-left: 1100px; position : absolute; top : 700px" > Inventaire <br></div>
  
    <div id="dbox">
      <div id="dboxm">Test</div>
      <input type="button" value="OK" onclick="dbox()"/>
    </div>
    <button onclick ="cbox('Oui')">test</button>
    <button onclick ="updateHealth(20)">Vie+</button>
    <button onclick ="updateHealth(-20)">Vie-</button>
    <div id="cbox">
      <div id="cboxm">Testc</div>
      <input id="butboxt" type="button" value="OK" onclick="cbox()"/>
      <input id="butboxf" type="button" value="NOP" onclick="cbox()"/>
    </div>


    <style>
      #dbox {
        /* (A1) CENTER ON PAGE */
        text-align: center;
        position: fixed;
        top: 40%; left: 50%;
        transform: translate(-50%);
        /* (A2) DIMENSIONS */
        width: 400px;
        padding: 10px;
        /* (A3) COLORS */
        color: #333;
        border: 1px solid #c52828;
        background: #ffebe1;
        /* (A4) HIDE */
        display: none;
      }
      #cbox {
        /* (A1) CENTER ON PAGE */
        text-align: center;
        position: fixed;
        top: 40%; left: 50%;
        transform: translate(-50%);
        /* (A2) DIMENSIONS */
        width: 400px;
        padding: 10px;
        /* (A3) COLORS */
        color: #333;
        border: 1px solid #c52828;
        background: #ffebe1;
        /* (A4) HIDE */
        display: none;
      }
      </style>
  </body>
</html>




